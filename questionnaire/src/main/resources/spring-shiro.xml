<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- 配置安全管理器securityManager， 缓存技术: 缓存管理 realm:负责获取处理数据 -->
        <bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">
            <property name="realm" ref="myShiroRealm" />
            <property name="cacheManager" ref="cacheManager" />
        </bean>
        
        <!-- 項目自定义的Realm,从数据库中获取用户的安全数据 -->
        <bean id="myShiroRealm" class="com.sclience.survey.common.base.realm.UserRealm">
            <!-- 配置缓存管理器-->
            <property name="cacheManager" ref="cacheManager" />
            <!-- 配置加密器 -->
            <property name="credentialsMatcher">
                <bean class="org.apache.shiro.authc.credential.HashedCredentialsMatcher">
                    <property name="hashAlgorithmName" value="MD5"></property> <!-- 加密算法的名称 -->
                    <property name="hashIterations" value="1024"></property> <!-- 配置加密的次数 -->
                </bean>
            </property>
        </bean>
     
        <!-- 用户授权信息Cache -->
        <bean id="cacheManager" class="org.apache.shiro.cache.MemoryConstrainedCacheManager" />
     
        <!-- 必须配置lifecycleBeanPostProcessor:管理shiro中常见的对象 -->
        <!-- 保证实现了Shiro内部lifecycle函数的bean执行 -->
        <bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" />


    <!-- 配置shiro的过滤器工厂类，id- shiroFilter要和我们在web.xml中配置的过滤器一致 -->
    <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">
        <!-- 调用我们配置的权限管理器 -->
        <!--<property name="securityManager" ref="securityManager" />-->
        <!-- 配置我们的登录请求地址,跳转到登录页面 -->
        <property name="loginUrl" value="/login.jsp" />
        <!-- 配置我们在登录页登录成功后的跳转地址，如果你访问的是非/login地址，则跳到您访问的地址 -->
        <property name="successUrl" value="/index.jsp" />
        <!-- 如果您请求的资源不在您的权限范围，则跳转到/403请求地址 -->
        <property name="unauthorizedUrl" value="/403.html" />
    </bean>

</beans>